{% extends "base.html" %}
{% block title %}Ассеты — AssetHub{% endblock %}

{% block content %}

<h1 class="mb-4">Ассеты</h1>

<form class="row gy-2 gx-3 align-items-end mb-4" method="get">

    <!-- Поиск -->
    <div class="col-md-4">
        <label class="form-label">Поиск</label>
        <input type="text" name="q" class="form-control"
               placeholder="Название, описание, проект, автор"
               value="{{ q or '' }}">
    </div>

    <!-- Фильтр по автору -->
    <div class="col-md-3">
        <label class="form-label">Автор</label>
        <select name="author" class="form-select">
            <option value="">Все авторы</option>
            {% for author in all_authors %}
                <option value="{{ author }}"
                    {% if author_filter == author %}selected{% endif %}>
                    {{ author }}
                </option>
            {% endfor %}
        </select>
    </div>

    <!-- Фильтр по тегу -->
    <div class="col-md-3">
        <label class="form-label">Тег</label>
        <select name="tag" class="form-select">
            <option value="">Все теги</option>
            {% for tag in all_tags %}
                <option value="{{ tag.name }}"
                    {% if tag_filter == tag.name %}selected{% endif %}>
                    {{ tag.name }}
                </option>
            {% endfor %}
        </select>
    </div>

    <!-- Сортировка -->
    <div class="col-md-2">
        <label class="form-label">Сортировка</label>
        <select name="sort" class="form-select">
            <option value="new" {% if sort == 'new' %}selected{% endif %}>Сначала новые</option>
            <option value="old" {% if sort == 'old' %}selected{% endif %}>Сначала старые</option>
            <option value="title" {% if sort == 'title' %}selected{% endif %}>По названию (А–Я)</option>
            <option value="author" {% if sort == 'author' %}selected{% endif %}>По автору (А–Я)</option>
        </select>
    </div>

    <div class="col-12 mt-2">
        <button class="btn btn-primary">Применить</button>
        {% if q or tag_filter or author_filter or sort != 'new' %}
            <a href="{{ url_for('assets.assets_list') }}" class="btn btn-outline-secondary ms-2">
                Сбросить
            </a>
        {% endif %}
    </div>
</form>

<div class="row g-4">
    {% for asset in assets %}
    <div class="col-sm-6 col-md-4 col-lg-3">
        <div class="card shadow-sm asset-card h-100">

            <img src="https://placehold.co/400x200"
                 class="card-img-top" alt="preview">

            <div class="card-body d-flex flex-column">
                <h5 class="card-title">{{ asset.title }}</h5>
                <p class="card-text text-muted mb-1">{{ asset.asset_type }}</p>

                {% if asset.tags %}
                <p class="mb-2">
                    {% for tag in asset.tags %}
                        <a href="{{ url_for('assets.assets_list', tag=tag.name) }}"
                           class="badge bg-secondary text-decoration-none">
                            {{ tag.name }}
                        </a>
                    {% endfor %}
                </p>
                {% endif %}

                <div class="mt-auto">
                    <a href="{{ url_for('assets.asset_detail', asset_id=asset.id) }}"
                       class="btn btn-sm btn-outline-primary">
                        Подробнее
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% else %}
        <p>Ассеты не найдены.</p>
    {% endfor %}
</div>

{% endblock %}

